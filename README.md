# 42메이트

    팀명: 우리사이무슨사이
    프로젝트명: 42mate

# 프로젝트 개요
**하루에 한 번 42분간의 만남을 매칭하는 슬랙봇**

42seoul을 진행하며 학습에 대한 열의와 열린 태도를 가지고 있는 멋진 동료들을 많이 만날 수 있었습니다. 
하지만 다들 모니터를 보느라 바쁘다보니, 서로를 알아갈 계기가 부족한 것이 아쉬웠습니다. 멋진 동료들과 라포가 쌓인다면 상호작용의 질이 향상되지 않을까요?



# 프로젝트 상세
42 mate는 우리의 만남을 장려합니다.
학습에 대한 열의와 열린 태도를 가지고 있는 42서울인들이 더욱 친밀해질 기회를 제공합니다.
슬랙앱을 만듭니다. 하루에 한 번, 42분간의 만남을 매칭합니다.


# 기대성과
42서울인들의 관계자산을 늘림으로써 서로의 학습에 대해 시너지를 주기를 기대합니다.

# We are..

eunhkim 역할: 팀장 / 핵심기여역량: 소스 개발, 프로젝트 관리
jaejeon 역할: 팀원 / 핵심기여역량: 소스 개발, 프로젝트 관리
iwoo 역할: 팀원 / 핵심기여역량: 소스 개발, 프로젝트 관리


# 개발 환경
개발 도구: Python, Flask, Heroku, Postgresql...
협업 도구: Slack, Github, Trello
개발 방식: 밀도 있는 페어 코딩과 코드 리뷰 중심의 협력 개발

# 개발 일지
팀미팅 이후 성과, 이슈, TODO 별로 나눠서 작성

## 2020.04.16

#### 성과
- 프로젝트에서 원하는 것 공유
  - 학습
  - 협업경험
  - 실제 사용가능한 프로덕트
  
- 기획
  - 아이템 선정
    - 42의 학습방식을 비소프트웨어 주제에 적용하는 웹 서비스
    - 42 Slack에서 유용하게 사용할 수 있는 슬랙봇
    - **42 Learner들이 서로를 잘 이해하고, 라포를 쌓을 수 있게하는 서비스/테스트/슬랙봇**
      - 42서울인들의 학습에 도움을 주는 서비스이고, 프로젝트를 만드는 입장에서도 모르던 영역을 배운다는 점에서 도전의식이 생겼음.
    - 기존 시장의 문제들을 해결하는 보드게임 중고거래 서비스
    - C++를 재미있고 쉽게 익힐 수 있는 소프트웨어

- 협업 규칙 협의
    - **비동기적 개발**: 계속 할일을 찾아가며 코드를 개발하는 방식
    - **어떤 함수라도 세 명의 참여 필수**: 팀원이 모두 손을 대어야 우리의 함수이다.
    - **데일리 리뷰 진행**
      - 일시: 매일 오후 13시
      - 내용: 회고, TODO, 논의하고 싶은 사항, 도움 받고 싶은 사항 공유
    - 기타 변경사항은 프로젝트 진행하며 논의 후 추가

- 사용 기술 논의
  - Language: Python 선택. 셋 모두 과거에 진행한 타 프로젝트, '42 AI bootcamp' 등을 통해 파이썬 기초를 접한 상태이고 시간이 제한되어있으니 학습비용이 낮다는 판단.
  - Web framwork: Flask, Django 중 무엇이 적합할지 조사 필요.
  - Database: 무엇이 주로 쓰이는지 확인 필요.
  - Server cloud: AWS, Heroku 등등의 서비스 중 무엇이 적합할지 조사 필요.
  - 그 외 슬랙봇 구현에 필요한 기술이 무엇이 있는지 조사 필요.
  
#### TODO
  - Task list 작성을 위해 아래 두 가지 진행(*아직 뭘 진행해야하는지도 모르는 상태..*)
    - 슬랙봇 작동원리 조사
    - 구현해야할 최소기능 생각
  - 슬랙봇이 42서울 워크스페이스에서 작동가능한지 여부 문의할 것.

## 2020.04.17 ~ 2020.04.19

#### 성과
- 사용할 기술 추가협의
  - Web framwork: Flask
    - 이유: 가벼운 프로젝트를 구현하는데 적합하다고 하고, 필요한 서비스를 직접 연동시키는 경험을 할 수 있기 때문에 학습자에게 적합하다고 함.
  - Database: Postgresql, SQLAlchemy
    - 이유: 둘 모두 참고자료를 찾기 쉬웠음. heroku에서 Postgresql을 연동한 서비스를 제공하고 있고, 주로 SQLAlchemy와 함께 쓰는 것으로 보임.
  - Server cloud: heroku
    - 이유: AWS보다 가볍고 간편하게 cloud서비스를 이용할 수 있어서 작은 규모의 프로젝트를 학습용으로 만드는데 주로 쓰인다고 함.

#### 이슈
 - 앱 토큰을 쓰는 방식과 webhook을 쓰는 방식이 있는 것 같다. 둘 중 하나를 선택 필요
 - 헤로쿠에서 원하는 형태로 DB연동을 시켜야한다.

#### TODO
 - register, unregister, list 확인 명령어를 구현하는 것을 도전

## 2020-04-20

#### 성과
 - 은휼님이 register, unregister, list 확인 명령어를 구현하여 DB연결하는 것을 성공함.

#### 이슈
 - 테스트환경과 배포를 어떻게 할 것인가 논의 필요
    - 방법1: local에서 개발한 것을 ngrok으로 만들고, 슬랙에서 테스트 후 heroku로 올리는 방법
    - 방법2: 앱을 두개 만들어서 하나는 테스트, 하나는 배포용으로 활용
    - 방법3: ngrok을 이용한 테스트봇 3개와 heroku를 이용한 메인 봇을 만들 것.
 - 앱 토큰이 히로쿠로 푸쉬하면 슬랙에서 비활성화되는 문제
    - 서버로 코드를 올리는 과정에서 코드가 public한 공간에 공개되면 앱 토큰이 노출되므로 삭제되는 것으로 추측됨. 
    - private repo에 올려서 되는지 실험해보고 hardcoding된 값들을 환경변수로 감춰서 public repo에 올리면 되는지도 실험해볼 필요가 있음.
    
#### TODO
 - 22일에 오프라인에서 만날 때까지 어떤 식으로 앱을 기획하면 좋을지 구상

## 2020-04-21 ~ 2020-04-22

#### 성과
 - 앱 세부기획 진행
    - user는 42seoul 구성원이며 needs는 1) 학습욕구 2) 소셜욕구를 가지고 있다. 그 중 소셜욕구를 충족시키는 방향으로 결정함. 소셜욕구가 충족되면 학습욕구 해소까지 이어지도록 유도할 수 있을거라고 기대
    - 서비스형태는 1) 정보를 입력받고 2) 하루에 한번 42분간 만날 user를 매칭하고 3) 메세지로 알려주는 형태로 결정
    - 버전별로 구현할 기능과 DB모델 정함. DB모델은 아래와 같음.
        - version 1.0
            - **User 테이블**
                - **Slack_id (프라이머리 키)**
                - **Intra_id**
                - **Register (type: boolean)**
                - **Joined (type: boolean)**
            - **Match 테이블**
                - **Index (프라이머리 키)**
                - **Date_time (type: time)**
                - **User A (slack_id)**
                - **User B (slack_id)**
        - version 2.0
            - User 테이블
                - Slack_id (프라이머리 키)
                - Intra_id
                - Register (type: boolean)
                - Joined (type: boolean)
                - **Noshow_count (type: int)**
                - **Noshow_rate (type: double)**
                - **Satisfy_rate (type: double)**
            - Match 테이블
                - Index (프라이머리 키)
                - Date_time (type: time)
                - User A (slack_id)
                - User B (slack_id)
            - **Eval 테이블**
                - **Index (프라이머리 키)**
                - **Match**
                - **User_from**
                - **User_to**
                - **No_show (boolean)**
                - **Satisfy (double)**
        - version 3.0
            - User 테이블
                - Slack_id (프라이머리 키)
                - Intra_id
                - Register (type: boolean)
                - Joined (type: boolean)
                - Noshow_count (type: int)
                - Noshow_rate (type: double)
                - Satisfy_rate (type: double)
                - **Interest**
            - Match 테이블
                - Index (프라이머리 키)
                - Date_time (type: time)
                - User A (slack_id)
                - User B (slack_id)
                - Eval 테이블
                - Index (프라이머리 키)
                - Match
                - User_from
                - User_to
            - **Interest 테이블**
                - **Index (프라이머리 키)**
                - **Interest**
                - **User**
                - **Question**
                - **Link**
#### TODO
 - 기본이 되는 테스트 슬랙 봇 구현
    - 페어 프로그래밍으로 개발환경과 기본 구현 방식을 동기화

## 2020-04-23

#### 성과

 - **기본 테스트 슬랙봇 구현** <br>
    - 지금까지는 각자 학습을 위해 슬랙봇을 따로 만들어본 상태였음. 본 프로젝트를 위해 개발환경을 동기화하고, 함께 쓸 코드를 작성할 필요를 느꼈고, 각자 페어프로그래밍 방식으로 약 4시간 30분 동안 진행함. 과정은 아래와 같음.
    - **파이참으로 프로젝트 생성**
        - 파이참과 vscode 중 무엇을 쓸지 논의하였고, eunhul님 컴퓨터에서 vscode가 컴퓨터자원을 많이 소모하는 이슈가 있고, 파이참이 파이썬 라이브러리 설치나 가상환경 셋팅 등이 편리한 것 같다는 이유로 파이참을 선택함.
    - **Flask 등 필요한 라이브러리를 설치** 
    - **슬랙앱 생성**
        - 권한 scope 설정하여 slack app token을 발급 받아서 플라스크에 연동시킴.
    - **데이터베이스 생성 및 연동**
        - **user table, match table** 생성
        - primary key가 string보다는 integer 타입으로 관리되는 것이 간편하다고 하여 match table에도 index column을 추가
        - user와 match간의 관계가 ‘many to many’라는 것을 감안하여 **user_identifier table**을 추가함.
    - **Heroku로 배포, 데이터베이스 연동**

#### 이슈
 - match가 생성되었을 때 저장되는 시간 값이 미국 서버 시간 기준으로 저장되는 것으로 보인다. 한국시간으로 바꿔줄 필요가 있다.
 - 프로토타입을 위해 구현하고 처리해야할 기능,이슈들을 트렐로에 정리가 필요하다.

**추가 협의사항**
 - 문자열 사용시 쌍따옴표(“) 활용, key값은 홀따옴표(‘) 활용

#### TODO
 - UI개선을 위해 block-kit 학습

## 2020-04-24

#### 성과
 - 42mate 서비스 이용에 필요한 버튼을 구현하는 것이 command를 이용하는 것보다 유저친화적이라는 판단하에 block kit으로 42mate 커맨드 버튼 뷰를 구현하기로 함.
 - 논의를 바탕으로 42mate 1.0 version을 위해 필요한 task를 정리하여 트렐로에 카드 생성함. 정리한 task는 현재 아래와 같음.
    - 서버 한국시간 설정
    - 42mate 커맨드 버튼 뷰 구현
    - 커맨드 입력값 제어 & 예외처리
    - register 커맨드 구현
    - unregister 커맨드 구현
    - join 커맨드 구현
    - bye 커맨드 구현
    - 매칭 구현
    - 앱 이미지 디자인

#### 이슈
 - develop 브런치를 새로 만들어서 배포 프로젝트와 개발중인 프로젝트를 분리시켜야할 것 같다. 논의하여 진행할 것

#### TODO
 - 각자 원하는 task를 처리할 것

## 2020-04-25

#### 성과
 - match 테이블의 match time 에 저장되는 값을 어떻게 처리할지 정함.
    - UTC 값이 match 테이블에 저장되도록하고, 해당 시간 활용시 localtime으로 변환해서 사용하기로 협의
 - 커맨드 버튼뷰를 구현함.
    - 슬랙 id가 이미 등록되었는지 여부에 따라 register 함수 실행여부를 결정하는 형태까지 구현됨
   - bye로 통칭하던 기능의 이름이 적절하지 않다는 의견에 따라 unjoin으로 기능의 이름을 변경
 - 하나의 작업을 혼자서 모두 하지 않는다!는 원칙하에 협업방식 세부설정
    - 카드 사이즈가 크면 체크리스트를 쪼개가면서 설정한다. 이를 위해 원래 작업하시던 분에게는 체크리스트를 요청해야함.
    - 그럼 체크리스트를 완료했다면? 로컬에서 원래 작업자의 branch로 pull request를 날린다.
    - 혼자 하더라도 팀미팅시 코드 공유해서 모든 팀원에게 학습이 일어나야한다.
    
#### 이슈
 - 커맨드 뷰에서 유저의 상태에 따라 보여주는 버튼뷰가 달라져야함.
 - 깃헙 브랜치들을 정리 필요. 특히 누군가가 작업 중인 task에 어떻게 참여할지 방식 협의 필요.
    - 밋업에서 지금까지 한 것을 또 푸쉬하고, 필요한 것을 수정한다. 이후 각자의 브런치에 만든 기능을 만든다음에 dev에 pull request해서 리뷰를 거쳐서 둘 중 하나를 merge한다.
    - 로컬에서는 트렐로 카드별로 로컬브랜치가 따로 있어야함.

#### TODO
 - 스케쥴  포함해서 매칭 함수 구현
 - 커맨드뷰 구현 위해 시나리오 작성
 - 우선 attachment를 하드코딩하고 커맨드뷰 코드 구현
 - get_attachments 함수 구현 시작


## 2020-04-26

#### 성과
 - request 모듈에 대한 이해도 증가
 - command_view 함수의 구조 완성(user에게 보여질 get_attachment 함수 영역 제외)
 - Datetime 함수와 UTC에 대한 학습을 진행함으로써 서버에서 시간을 잘 다룰 수 있게 됨
 - match 함수를 기능적으로 구현함. random 라이브러리의 sample 함수를 이용해 2 유저씩 매칭.
#### 이슈
 - 지금 get_attachment 함수는 commandview에 대한 것만 만들기로 했는데, 다른 메세지를 추가로 보내야할 수 있고, 이 때 get_attachment 함수가 그대로 쓰일 수 없을 것 같다. 
    - 지금 1.0 버전에 필요한 기능은 아닌 것 같고, 다음 버전으로 갈 때 리팩토링해서 get_attachment 클래스를 만들고 안에 commandview, feedback같은 함수를 따로 만들어서 쓰는 방향 결정
 - info 커맨드 기능에 재정의 필요성 논의 필요
    - 개발 계획에서 info 커맨드를 구현할 때 우리가 생각했던 게 ‘join, register에 관한 정보들을 간단하게 조회하는 기능'이었다고 생각. interest를 구현할 경우 관심사 정보를 추가적으로 구현할 수 있음. 
    - info는 기본적으로 버튼 구현 없이 42mate 커맨드 입력시 보여주는 방향으로 하되, history 커맨드 개발에 대해 추후 고려하는 방향 결정
- 시간과 관련된 코드들은 UTC로 통일할지 여부결정 필요
    - UTC를 베이스로 시간과 관련된 코드들을 다루고자 함. heroku 서버의 경우 UTC로 시간이 기록되지만, 시간을 다룰 때 확실하게 UTC로 변환시켜서 쓰는 것으로 개발.
- Attachment 대신 Blocks를 쓸지 논의 필요
    - attachments는 blocks의 하위개념으로 보인다. attachment는 block 안에 넣어서 쓰도록 함. 현재 attachment를 다루는 함수들을 block을 다루는 함수로 변경 필요
- match 함수에서 db에 접근하는 회수가 많고, 리팩토링할 여지들이 있음. 
    - joined 값을 false로 전환하는 코드는 한 번에 처리할 수 있도록 개선. select도 최초 한 번, 커밋도 최종적으로 한 번 하는 방향으로 개선.
- 스케쥴러 기능의 경우, sleep문이 들어있는데 그 값에 따라 스케쥴외의 기능도 멈출 것 같다고 추정됨. 
    - 문제가 확실히 있는지 확인하고, 쓰레드 개념을 적용하여 해결할 수 있는지 확인할 필요있음.

#### TODO
 - match 함수 리팩토링. 12시 정각에 실행되도록 스케쥴러 추가. sleep의 파라미터에 따른 앱 이슈 여부 확인 필요.
 - callback함수 내에 버튼 클릭에 따른 분기동작 구현
 - get_blocks 함수 구현. 로컬 환경 세팅 -> Heroku dev 로 변경



## 2020-04-27

#### 성과
 - command view에서 user가 버튼을 눌렀을 때 button value를 확인해서 그에 맞는 분기를 만들고, 적절한 처리 프로세스를 작성하는 작업을 진행.
 - command view에서 user가 버튼을 눌렀을 때 action time(utc)에 따라 액션의 수행여부를 판단하는 코드 추가.
 - match 함수 리팩토링. APscheduler를 활용하여 서버 차원에서 정해진 시각(자정)에만 함수를 실행하도록 변경. match 함수도 clock.py에 별도 분리.
 - 슬랙에서 권장하는대로 기존에 attachment 를 사용하는 것에서 blocks를 사용하는 방식으로 바꾸고 get_blocks 함수 구현 
    - blocks를 사용하는 과정에서 slacker API의 문제점 발견하여 수정요청 PR 보냄
    
#### 이슈
 - 모든 구현을 app.py파일에서 진행하다보니, 코드가 필요이상으로 길고 가독성이 떨어진다.
 - 기능별로 함수를 따로 파일로 만들 필요가 있다
    - ex) app.py에는 @app.route()에 해당하는 함수들만 남기자. block들을 모아서 관리하는 blocks.py 파일을 만들자.
 - 커밋이 자주 되지 않다보니 feature branch 단위의 협업이 어려움
    - feature branch에 대한 commit & push를 자주 할 필요가 있다. 작은 단위라도 구현이 완료되었으면 바로바로 커밋 & 푸쉬할 것. 
 - 테스트 코드 작성시 아직 구현되지 않은 함수가 있을 때, 해당 코드의 리턴 값을 테스트 돌릴 함수안에서 직접 하드코딩해서 쓰는 방식이라 이후 구현된 함수와 연결이 번거롭다.
    - 구현하기로 한 함수를 선언해놓고 그 안에서 하드코딩하여 리턴값을 가져오는 식으로 구현할 필요가 있다. 때문에 함수 프로토타입(이름, 파라미터, 리턴 값...)에 대한 공유가 반드시 필요
 - DB 셀렉트할 때 필요한 횟수보다 더 많은 횟수만큼 셀렉트하는 문제(N+1 문제)가 있다.
 
#### TODO
 - 페어 프로그래밍으로 develop 브랜치에 함께 공유할 코드 작성
 - get_user_state 함수 구현
 
 
## 2020-04-28

#### 성과
 - match feature의 변수명과 파일명 개선. 직관적으로 변수의 내용을 알 수 있도록 변경.
 - match feature에서 while 문의 조건에서 리스트의 길이를 매번 검사하는 것이 아니라 최초 1회 검사 후 해당 값을 이용해 while문 진행.
 - permission 이용해서 bot이 가입되지 않은 채널에도 메시지가 갈 수 있는 걸 확인. 임시 메시지 전송 api 테스트. 임시 메시지 udpate 테스트.
 - 앱 이미지 디자인.

#### 이슈
 - docker를 이용함으로써 해당 프로젝트의 유연성과 확장성을 확보할 수 있는 방법에 대한 고민
 - Ephemeral message의 철자를 기억하기 어렵고 발음하기 어렵다.
    - '임시메세지'로 통칭하기로 협의
 - 클러스터 개학 시기가 미뤄짐에 따라 ‘오프라인 만남 유도 서비스’의 테스트가 어려울 것이 예상됨. 
    - 당초 논의되었던 ‘온라인 만남 유도 서비스’로 전환하기로 협의.
        - 안내 메세지 변경 필요
        - DM으로 매칭된 두 사람을 초대해서 대화 유도하는 형식으로 변경
        - 기타 아이디어: 온라인 챌린지, 페어프로그래밍 유도
    - 이를 위해 아래 세가지 방안 논의됨.
        - 1-1) 본투비 슬랙 도입요청
            - 한국 유저들만 쓸 수 있는 상태이고, 아직 완성도가 떨어져서 도입요청하기 부족함.
        - 1-2) 42메이트용 슬랙 임시 개설
            - 이용하지 않을 유저의 앱에 대한 이해도, 이용할 가능성이 있는 유저에 대한 앱 매력도, 이용할 유저들의 앱 사용방법 가이드를 위한 안내가 필요
            - ex) 목업 페이지 제작, README 등 통해
- 임시메시지를 슬랙 앱에서 어떻게 다루는 것이 좋은가에 대한 논의. 임시메시지를 이용하고, 업데이트하는 것이 좋은 행동인가에 대한 의문 제기. 
    - 임시메세지와 DM의 UI 비교
        - 임시메시지가 즉각적으로 뜨는 것은 좋으나, 채팅창에서 시선이 분산되고 또 채팅이 밀려 올라감에 따라 이용이 어려워지는 불편함이 있음.
    - 임시메시지는 DM이 발송됨을 알리는 안내 메시지로 사용하길 협의
        - 이 때 커맨드를 치는 위치에 따라 적절한 안내메세지 내용이 표시되어야함.
        - DM으로 커맨드 뷰 구현
- 커맨드 뷰 UI/UX 이슈. 버튼 클릭, 버튼 추가 호출시 버튼 업데이트, 버튼 삭제, 액션 성공 메시지 등을 어떻게 처리할 것인가에 대한 논의 필요.
    - 호출되었던 버튼 삭제 && 액션 성공 메세지 보내는 방식이 좋을거라 생각됨.
    - 그런데 버튼을 여러번 눌러야하는 상황이 우려된다. ex) info
    - 유저의 연속적인 버튼 이용 가능성이 있을 경우 버튼 업데이트 && 액션 성공 메시지를 예외적으로 고려한다. ex) info 누르면 info를 표시하기
- 1.0 version  Due date 재조정
    - 5월 1일 금요일까지
- 온라인이라 어색할 수 있기 때문에 챌린지 블록을 형성하여 아이스 브레이킹을 유도. ver 1.0에 들어갈 성격은 아니므로 1.0 구현 이후 고려.
		
#### TODO
 - command_callback 구현 완료
 - 버튼 클릭시 보여줄 성공메세지 블록 작성
 - 버튼 클릭시 메세지 성공메세지로 업데이트 방식으로 변경
 - join, unjoin, unregister 커맨드 구현
 
## 2020-04-29

#### 성과
 - ver 1.0 대부분 완성 및 dev에 반영.
 - 파이쏘닉에 대해 공부함.
 
#### 이슈
 - 버튼 등 프론트적인 요소를 어느 버전부터 완성 적용할지.
    - 일요일까지 버전업되는 것을 보고 적용.
 - 현재 user_state로 들어오는 인자가 list인 경우가 있고 아닌 경우가 있는데 애초에 통일시키는게 맞을 것 같다.
    - list가 아니라 string으로 인자를 보내도록 통일
    
#### TODO
 - ver 1.5까지 가능한 버전 업
    - 오늘 하루동안 페어프로그래밍하며 적어도 1.0은 끝내고, 1.1은 구현 시작할 것
 - ver 1.0에서 리팩토링
